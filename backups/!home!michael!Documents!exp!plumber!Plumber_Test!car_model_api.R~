library(plumber)
library(ggplot2)

# load model
setwd("~/Documents/exp/plumber/Plumber_Test/")
cars_model <- readRDS("cars-model.rds")

#* @apiTitle mtcars model API
#* @apiDescription Endpoints for working with mtcars dataset model

#* Log some information about the incoming request
#* @filter logger
function(req) {
  cat(as.character(Sys.time()), "-",
      req$REQUEST_METHOD, 
      req$PATH_INFO, "_",
      req$HTTP_USER_AGENT, "@",
      req$REMOTE_ADDR, "\n")
  plumber::forward()
}

#* Parse and predict on model data for future endpoints
#* @filter predict
function(req, res) {
  # browser()
  # only parse responseBody if final endpoint is /predict/...
  if (grepl("predict", req$PATH_INFO)) {
    # parse postBody into data.frame and store in req 
    req$predict_data <- tryCatch(jsonlite::fromJSON(req$postBody),
                                 error = function(e) NULL)
    if(is.null(req$predict_data)) {
      res$status <- 400
      return(
        
      )
    }
  }
}